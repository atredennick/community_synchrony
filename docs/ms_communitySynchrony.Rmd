---
layout: 12pt
header-includes:
   - \usepackage{lineno}
   - \linenumbers
   - \usepackage{setspace}
   - \usepackage{todonotes}
   - \doublespacing
   - \usepackage[document]{ragged2e}
   - \usepackage{color}
   - \usepackage{rotating}
bibliography: ~/Dropbox/Bibliography/CommunitySynchrony.bib
csl: components/ecology.csl

## rmarkdown render options
output:
  pdf_document:
    fig_caption: true
    keep_tex: false
fontsize: 12pt
geometry: margin=1in
linkcolor: black
urlcolor: black
---
```{r caching, include=FALSE}
library("methods")
library("knitr")
basename <- "ms_communitySynchrony"
opts_chunk$set(fig.path = paste("components/figure/", basename, "-", sep=""),
               cache.path = paste("components/cache/", basename, "/", sep=""))
opts_chunk$set(cache = 2)
opts_chunk$set(tidy=FALSE, warning=FALSE, message=FALSE, 
               comment = NA, verbose = TRUE, echo=FALSE)

# PDF-based figures
opts_chunk$set(dev='pdf')
```

\begin{singlespace}

\begin{center}
\large{\textbf{Environmental responses, not species interactions, determine species synchrony in five natural plant communities}}

\renewcommand*{\thefootnote}{\fnsymbol{footnote}}

\vspace{1em}

\normalsize{Andrew T. Tredennick\textsuperscript{1}, Claire de Mazancourt\textsuperscript{2}, Michel Loreau\textsuperscript{2}, and Peter B. Adler\textsuperscript{1}}

\vspace{1em}

\textit{\small{\textsuperscript{1}Department of Wildland Resources and the Ecology Center, 5230 Old Main Hill, Utah State University, Logan, Utah 84322 USA}}

\textit{\small{\textsuperscript{2}Centre for Biodiversity Theory and Modelling, Experimental Ecology Station, Centre National de la Recherche Scientifique, Moulis, 09200, France}}

\end{center}

\vspace{2em}

\textit{Keywords}: synchrony, compensatory dynamics, environmental stochasticity, demographic stochasticity, stability

\vspace{2em}

\textbf{Authorship}: ATT, CdM, and PBA designed the research, ATT performed the research, and ATT, CdM, ML, and PBA contributed to the analyses and interpretation of results. All authors contributed to writing the manuscript.

\textbf{Running Title}: Drivers of species synchrony in natural plant communities

\textbf{Article Type}: Letter

\textbf{Number of Words}: Abstract = ; Main Text = 

\textbf{Number of References}: 

\textbf{Number of Tables and Figures}:  3 Tables;  3 Figures

\textbf{Corresponding Author}: \\
\hspace{2em}Andrew Tredennick \\  
\hspace{2em}Department of Wildland Resources and the Ecology Center\\
\hspace{2em}Utah State University \\
\hspace{2em}5230 Old Main Hill \\
\hspace{2em}Logan, Utah 84322 USA \\
\hspace{2em}Phone: +1-970-443-1599 \\
\hspace{2em}Fax: +1-435-797-3796 \\
\hspace{2em}Email: atredenn@gmail.com

\end{singlespace}
\renewcommand*{\thefootnote}{\arabic{footnote}}
\setcounter{footnote}{0}

\newpage{}

\begin{abstract}
Temporal asynchrony among species is an important mechanism through which diversity can stabilize ecosystem function, but elucidating the mechanisms underlying species synchrony remains a challenge.
Here, we extend theory to predict species synchrony under limiting cases that we couple with an empirical analysis from five plant communities.
When parameterized with empirical estimates, our prediction of species synchrony under only environmental stochasticity best predicts observed synchrony of per capita growth rates.
In model simulations, average synchrony of per capita growth rates, which ranges from 0 (perfect asynchrony) to 1 (perfect synchrony), was higher when environmental variation was present (0.62) rather than absent (0.43).
Removing interspecific competition and demographic stochasticity had small effects on synchrony.
Our results suggest that all five communities represent the theoretical limiting case where demographic stochasticity and competition are weak, and community-wide synchrony can be predicted by the synchrony of species' environmental responses.
\end{abstract}

\newpage{}
<!-- THIS HOW TO COMMENT-OUT -->
\setlength{\parindent}{5ex}

INTRODUCTION
------------
The earth's ecosystems are in a period of rapid change due to species extinctions [@Cardinale2012], changes in community composition [@Dornelas2014a; @Vellend2013], and human-driven changes in the abiotic environment [@Vitousek1997].
Such changes can have profound impacts on the provisioning and stability of ecosystem services [@Loreau2001a; @Hooper2005; @Rockstrom2009].
In particular, studies of experimental grassland communities show that greater species richness leads to greater productivity [@Tilman2001] and temporal stability of productivity [@Tilman2006; @Hector2010].
The stabilizing effect of species richness stems from individual species fluctuating asynchronously through time [@Hector2010; @Isbell2009; @DeMazancourt2013a].
Species richness affects synchrony because larger species pools are more likely to contain species that respond disimilarly to environmental conditions [@Yachi1999], which implies that species losses will reduce ecosystem stability.
Even without species losses, abiotic homogenization can weaken compensatory dynamics and, in turn, decrease temporal stability of ecosystem function [@Hautier2014].
Thus, it is becoming clear that predicting the impacts of global change requires a mechanistic understanding of species synchrony in natural settings.

Theory identifies the three main determinants of species synchrony as environmental stochasticity, demographic stochasticity, and interspecific competition [@Loreau2008a; @Gonzalez2009; @Loreau2013].
For example, in a community composed of large (no demographic stochasticity) and weakly interacting (no interspecific competition) populations, community-wide species synchrony should be determined by the covariance of species' responses to the environment [@Loreau2008a].
However, such a prediction relies on a relatively simple population dynamical model and only holds under two assumptions: (i) species' responses to the environment are similar in magnitude and (ii) that all species have similar growth rates.
Whether such theoretical predictions hold in natural communities where species differences are unlikely to be symmetrical remains unkown.
Indeed, no study has explicitly tested theory on the drivers of species synchrony in natural communities. 

In grasslands, most empirical studies have focused on whether species synchrony is primarily an outcome of species-specific responses to environmental conditions [@Hautier2014] or competition [@Gross2014].
Even beyond grassland studies, whether competition or environmental responses drive compensatory dynamics remains controversial [reviewed in @Gonzalez2009].
In part, controversy remains because quantifying the relative strengths of each driver on the degree of synchrony from community time series [e.g., @Houlahan2007] is impossible.
This is because an unbiased null expectation for synchrony does not exist [@Loreau2008a] and observed synchrony can arise from non-unique combinations of factors [@Ranta2008].
For example, weak synchrony could reflect positive environmental correlations (synchronizing effect) offset by strong competition (desynchronizing effect), or negative environmental correlations and weak competition.

The best way to quantify the effects of environmental stochasticity, demographic stochasticity, and interspecific competition is to remove them one-by-one, and in combination.
This could be done experimentally, but empirically-based models of interacting populations offer a way to exploit existing data sets from natural communities.
For example, @Mutshinda2009 fit a dynamic population model to several community time series of insect and bird abundances.
They used a statistical technique to decompose temporal variation into competition and environmental components, and found that postively correlated environmental responses among species determined community dynamics.
While a major step forward, Mutshinda et al.'s (2009) modeling technique relied on abundance data that may or may not reliably capture competitive interactions that occur at the individual level.
Furthermore, although @Mutshinda2009 quantify the relative importance of environmental stochasticity and competition to explain the observed variation of species synchrony, they did not use the model to quantify how much synchrony changes when each factor is removed.

Here, we use multi-species population models fit to long-term demographic data from five semi-arid plant communities to test theory on the drivers of species synchrony.
Our objectives are to (1) derive and test theoretical predictions of species synchrony and (2) determine the relative influence of environmental stochasticity, demographic stochasticity, and interspecific competition on species synchrony in natural plant communities.
To achieve these objectives, we first refine theory that has been used to predict the effects of species richness on ecosystem stability [@DeMazancourt2013a] and species synchrony [@Loreau2008a] to generate predictions of community-wide species synchrony under two limiting cases derived from the dynamics of individual species in monoculture.
We then confront our theoretical predictions with data from five semi-arid plant communities by using empirically-based population models.
Second, we use the multi-species population models to perform simulation experiments designed to isolate the effects of environmental stochasticity, demographic stochasticity, and interspecific competition on community-wide species synchrony.
Given that our population models capture the essential features of community dynamics important to synchrony (density-dependence, demographic and environmental stochasticity) and that these models are able to reproduce observed plant abundances [@Chu2015], perturbing the models reveals the processes responsible for the degree of species synchrony in our focal grassland communities.


THEORETICAL MODEL
-----------------
### The model
Our objective is to derive analytical predictions for species synchrony under special limiting cases that may or may not be realized in natural communities.
We constrain our focus to synchrony of per capita growth rates, rather than abundance, because growth rates represent the instantaneous response of species to the environment and competition, and are less susceptible to the legacy effects of drift and disturbance [@Loreau2008a].
Following @Loreau2008a and @DeMazancourt2013a, we define population growth, ignoring observation error, as

\begin{align}
r_i(t) &= \text{ln}N_i(t+1) - \text{ln}N_i(t) \\
&= r_{mi} \left[ 1- \frac{N_i(t)+\sum_{j \neq i} \alpha_{ij}N_j(t)} {K_i} + \sigma_{ei}\mu_{ei}(t) + \frac{\sigma_{di}\mu_{di}(t)}{\sqrt{N_i(t)}} \right]
\end{align}

\noindent where $N_i(t)$ is the biomass of species *i* in year *t*, and $r_i(t)$ is its instantaneous growth rate in year *t*. 
$r_{mi}$ is species *i*'s intrinsic rate of increase, $K_i$ is its carrying capacity, and $\alpha_{ij}$ is the interspecific competition coefficient representing the effect of species *j* on species *i*. 
Environmental stochasticity is incorporated as $\sigma_{ei}\mu_{ei}(t)$, where $\sigma_{ei}^2$ is the environmental variance and $\mu_{ei}$ are normal random variables with zero mean and unit variance that are independent through time but may be correlated.
Demographic stochasticity arises from variations in births and deaths among individuals (e.g., same states, different fates), and is included in the model as a first order, normal approximation [@Lande2003; @DeMazancourt2013a].
$\sigma_{di}^2$ is the demographic variance and $\mu_{di}(t)$ are independent normal variables with zero mean and unit variance.

To derive analytical predictions we...CLAIRE'S TEXT ON DERIVING THE PREDICTION...

### Predictions
Our first prediction assumes no interspecific interactions, no environmental stochasticity, identical intrinsic growth rates, and that demographic stochasticity is operating but all species have identical demographic variances.
This limiting case, $\mathcal{M}_{D}$, represents a community where dynamics are driven by demographic stochasticity alone.
Our prediction is

\begin{equation}
\phi_{R,\mathcal{M}_{D}} = \frac{\sum_i p_i^{-1}}{\left(\sum_i p_i^{-1/2} \right)^2}
\end{equation}

\noindent for synchrony of per capita growth rates.
$p_i$ is the average frequency of species *i*, $p_i = N_i/N_T$.
When all species have identical abundances and $p_i = 1/S$, where *S* is species richness, synchrony equal 1/S [@Loreau2008a].

Our second limiting case assumes only environmental stochasticity is operating. Thus, there are no interspecific interactions, demographic stochasticity is absent, intrinsic growth rates are identical, and environmental variance is identical for all species.
Our prediction for this limiting case, $\mathcal{M}_{E}$, is 

\begin{equation}
\phi_{R,\mathcal{M}_{E}} = \frac{\sum_{i,j}\text{cov}(\mu_{ei},\mu_{ej})}{S^2}
\end{equation}

\noindent{} for synchrony of per capita growth rates.
Again, $p_i$ is the average frequency of species *i*, $p_i = N_i/N_T$, and $\text{cov}(\mu_{ei},\mu_{ej})$ is the standardize covariance (correlation) of environmental responses between species *i* and species *j*.
Confronting our theoretical predictions with data requires estimates of species dynamics in monoculture to calculate the covariance of species' environmental responses.
To estimate environmental responses in natural communities, we turn to our population models built using long term demographic data.


EMPIRICAL ANALYSIS
------------------
### Materials and methods
#### Data
In the early 20th century, several range experiment stations in the western U.S. began mapping permanent quadrats, and conducted annual censuses for decades. 
We use such long-term demographic data sets from five semiarid grasslands in the western United States (described in detail by @Chu2015).
Each study site includes a set of 1-$\text{m}^2$ permanent quadrats within which all individual plants were identified and mapped annually using a pantograph (Hill 1920).
The resulting mapped polygons represent basal cover for grasses and canopy cover for shrubs.
Data come from the Sonoran desert in Arizona [@Anderson2012], sagebrush steppe in Idaho [@Zachmann2010], southern mixed prairie in Kansas [@Adler2007], northern mixed prairie in Montana [@Anderson2011], and Chihuahuan desert in New Mexico [Anderson et al. in preparation, @Chu2015] (Table 1).

#### Calculating observed synchrony
The data consist of records for individual plant size in quadrats for each year.
To obtain estimates of percent cover for each focal species in each year, we summed the individual-level data within quadrats and then averaged percent cover, by species, over all quadrats.
We calculated per capita growth rates as $\text{log}(x_t) - \text{log}(x_{t-1})$, where *x* is species' percent cover in year *t*.
Using the community time series of per capita growth rates or percent cover, we calculated community synchrony using the metric of @Loreau2008a in the `synchrony' package [@Gouhier2014] in R [@R2013].
Specifically, we calculated synchrony as

\begin{equation}
\phi_r = \frac{\sigma^{2}_{T}}{(\sum_{i}\sigma_{r_{i}})^{2}}
\end{equation}

\noindent where $\sigma_{r_{i}}$ is the temporal variance of species *i*'s per capita population growth rate ($r_i$) and $\sigma^{2}_{T}$ is the temporal variance of the aggregate community-level growth rate. $\phi$ ranges from 0 at perfect asynchrony to 1 at perfect synchrony [@Loreau2008a].

#### Fitting statistical models
Vital rate regressions are the building blocks of our dynamic models: an integral projection model (IPM) and an individual-based model (IBM).
We followed the approach of @Chu2015 to fit statistical models for survival, growth, and recruitment.
We modeled survival probability of each genet as function of genet size, temporal variation among years, permanent spatial variation among groups of quadrats, and local neighborhood crowding from conspecific and heterospecific genets.
Regression coefficients for the effect of crowding by each species can be considered a matrix of interaction coefficients whose diagonals represent intraspecific interations and whose off-diagonals represent interspecific interactions [@Adler2010].
We modeled growth as the change in size of a genet from one year to the next, which depends on the same factors as the survival model.
We fit the survival and growth regressions using INLA [@Rue2014], a statistical package for fitting generalized linear mixed effects models via approximate Bayesian inference [@Rue2009], in R [@R2013].
Genet size and crowding were treated as fixed effects; spatial (quadrat groupings) and temporal (interannual) variation were treated as random effects on the intercept.

We modeled recruitment at the quadrat scale, rather than the individual scale, because it is impossible to attribute new genets to specific parents [@Chu2015].
Our recruitment model assumes that the number of recruits produced in each year follows a negative binomial distribution with the mean dependent on the cover of the parent species, permanent spatial variation among groups, temporal variation among years, and inter- and intraspecific interactions as a function of total species' cover in the quadrat.
We fit the recruitment model using a hierarchical Bayesian approach implemented in JAGS [@Plummer2003] using the `rjags' package [@Plummer2014] in R.
Again, temporal and spatial variation were treated as random effects.

#### Building dynamic multi-species models
Once we have fit the vital rate stastical models, building the population models is straightforward.
For the IBM, we initialize the model by randomly assigning plants spatial coordinates, sizes and species identities until each species achieves a density representative of that observed in the data.
We then project the model forward by using the survival regression to determine whether a genet lives or dies, the growth regression to calculate changes in genet size, and the recruitment regression to add new individuals that are distributed randomly in space.
Crowding is directly calculated at each time step since each genet is spatially referenced (just like the actual data).
Environmental stochasticity is not an inherent feature of IBMs, but is easily included since we fit year-specific temporal random effects for each vital rate regression.
Thus, to include temporal environmental variation, at each time step we randomly choose a set of estimated survival, growth, and recruitment parameters specific to one observation year.
For all simulations, we ignore the spatial random effect associated with variation among quadrat groups, so our simulations represent an average quadrat for each site.

The IPM is similar to the IBM in that it is built using the vital rate regressions [@Rees2009; @Rees2014], but it is different in that it is spatially-implicit and does not include demographic stochasticity.
Following @Chu2015, we use a mean field approximation that captures the essential features of spatial patterning to define the crowding index at each time step.
Temporal variation is included in exactly the same way as for the IBM.
For full details on the IPMs we use, see @Chu2015.

#### Simulation experiments
We performed removal simulation experiments where drivers (environmental stochasticity, demographic stochasticity, or interspecific competition) were removed one-by-one and combination.
To remove interspecific interactions, we set the off-diagonals of the interaction matrix for each vital rate regression to zero.
This retains intraspecific interactions, and thus density-dependence, and results in simulations where species are effectively growing in monoculture.
To remove the effect of a fluctuating environment, we removed the temporal (interannual) random effects from the regression equations.
To remove the effect of demographic stochasticity, we use the IPM rather than the IBM because the IPM does not include demographic stochasticity and demographic stochasticity cannot be removed from IBM simulations.
Since the effect of demographic stochasticity on population dynamics depends on population size [@Lande2003], we can control the strength of demographic stochasticity by simulating the IBM on different area sizes (e.g., plot sizes).
Note that the IPM must include environmental stochasticity because otherwise all populations go to a stable equilibrium, and the IBM must include demographic stochasticity because it explicitly models individual plants.

Using the above methods, we ran six simulation experiments:
(1) All drivers (environmental stochasticity, demographic stochasticity, or interspecific competition) present using the IBM;
(2) Demographic stochasticity removed using the IPM;
(3) Environmental stochastcity removed suing the IBM;
(4) Interspecific competition removed using the IBM;
(5) Interspecific competition and demographic stochasticity removed using the IPM; and
(6) Interspecific competition and environmental stochasticity removed using the IBM.
We ran IPM simulations for 2,000 time steps, after an initial 500 iteration burn-in period.
This allowed species time to reach their stable size distribution.
We then calculated the synchrony of species' per capita growth rates over 100 randomly selected contiguous 50 time-step sections.
We ran IBM simulations for 100 time steps, and repeated the simulations 100 times for each simulation experiment.
From those, we retained only the simulations in which no species went extinct due to demographic stochasticity.
Synchrony was calculated over the 100 time steps for each no extinction run within a model experiment.
To explore the effect of demographic stochasticity in different sized populations, we ran simulations (1) and (6) on plot sizes of 1, 2, 3, 4, and 5 square meters.

Results from our simulation experiments also allow us to test our theoretical predictions.
First, in the absence of interspecific competition and demographic stochasticity, species are effectively growing in large monocultures.
Therefore, we can use results from simulation (5) to estimate the covariance of species' responses to the environment ($\text{cov}(\mu_{ie}, \mu_{je})$) and parameterize Equation 3.
Parameterizing Equation 2 does not require simulation output because the only parameters are the species' relative abundances.
Second, simulations (5) and (6) represent the simulated version of our limiting case theoretical predictions.
Thus, we directly test the theoretical predictions by comparing them to observed synchrony and simulated synchrony.

### Results
Synchrony of species' per capita growth rates at our study sites ranged from 0.36 to 0.89 and synchrony of percent cover ranged from 0.15 to 0.92 (Table 2).
Synchrony tended to be higher in communities with few species (Arizona and New Mexico) and/or with relatively high temporal variability in percent cover (e.g., Montana).
Synchrony was lowest in Idaho, the only data set that includes two life forms: a shrub and three perennial grasses (Table 1).
For all five communities, species synchrony from IPM and IBM simulations closely approximated observed synchrony (Fig. X1), meaning that we can use the models to test the importance of different drivers of synchrony in these communities.
However, IBM-simulated synchrony is consistently, but only slightly, lower than IPM-simulated synchrony (Fig. X1), likely due to the desynchronizing effect of demographic stochasticity.

Across the five communities, our limiting case prediction of community-wide synchrony when only environmental stochasticity is operating ($\mathcal{M}_E$) best matched observed synchrony for per capita growth rates (Fig. 1).
The regression line between observed growth rate synchrony and predicted growth rate synchrony under prediction $\mathcal{M}_E$ was the only one whose slope and intercept were not significantly different from zero (*P* = 0.88) and one (*P* = 0.87), respectively (Supplementary Information X).
The regression line between observed and predicted growth rates under prediction $\mathcal{M}_D$ (demographic stochasticity only) had an intercept and slope significantly different from zero and one, respectively (Fig. 1).

Simulation experiments revealed that removing environmental fluctuations has the largest impact on synchrony, leading to a reduction in synchrony of species growth rates in four out five communities (Fig. 2).
Removing environmental fluctuations ("No E.S" simulations) decreased synchrony by 33% in Arizona, 48% in Kansas, 39% in Montana, and 40% in New Mexico.
Only in Idaho did removing environmental fluctuations cause an increase in synchrony (Fig. 2), but the effect was small (9% increase).
Species interactions are weak in these communities [Table SX and @Chu2015], so removing interspecific competition had little effect on synchrony (Fig. 2; "No Comp." simulations).
Removing competition caused, at most, a 5% change in synchrony (Table SX).
Removing demographic stochasticity ("No D.S." simulations) caused synchrony to increase slightly in all communities (Fig. 2), with an average 6% increase.
The desynchronizing effect of demographic stochasticity was able to modestly counteract the synchronizing force of the environment, but not enough to match the synchrony of species when only demographic stochasticity is operating (Fig. 3).
For all five communities, the synchrony of species' growth rates in monoculture was strongly associated with species synchrony in polyculture (rank correlation = 1; Fig. 3).
Results for synchrony of percent cover are qualitatively similar (Figs. SX-SX) but more noisy, as expected by theory [@Loreau2008a].


DISCUSSION
----------
Our study produced four main findings that were generally consistent across five natural plant communities: (1) limiting-case predictions from the theoretical model were well-supported by analagous simulations from the empirical models; (2) demographic stochasticity decreased community synchrony, as expected by theory, and its effect was largest in small populations; (3) environmental fluctuations increased community synchrony relative to simulations in constant environments because species-specific responses to the environment were positively, but not completely, correlated; and (4) interspecific interactions were weak and therefore had little impact on community synchrony.

### Simulations support theoretical predictions


### Demographic stochasticity decreases synchrony
Demographic stochasticity is able to partially counteract the synchronizing effects of environmental fluctuations and interspecific interactions on per capita growth rates, but only when populations are small (Fig. 3), in agreement with theory [@Loreau2008a].
Even in small populations, however, demographic stochasticity is not a strong enough force to induce independent fluctuations (Fig. 3).
These results confirm the theoretical argument by @Loreau2008a that independent fluctuations among interacting species in a non-constant environment should be rare.
Only in the Idaho community does synchrony of per capita growth rates approach independent fluctuations (1/*S*, where *S* is the number of specuies) in a non-constant environment (Fig. 3).
This is most likely due to the strong effect of demographic stochasticity on the shrub *Artemisia tripartita* since even a 5 $\text{m}^2$ quadrat would only contain a few individuals of that species.

### Environmental fluctuations drive community synchrony
In large populations where interspecific interactions are weak, synchrony is expected to be driven exclusively by environmental fluctuations (Equation 4).
Under such conditions community synchrony should approximately equal the synchrony of species' responses to the environment [@Loreau2008a].
Two lines of evidence lead us to conclude that environmental fluctuations drive species synchrony in our focal plant communities.
First, in our model simulations, removing interspecific interactions resulted in no discernable change in community-wide species synchrony of per capita growth rates (Fig. 2).
Second, removing environmental fluctuations from simulations consistently reduced synchrony (Fig. 2), and the synchrony of species in monoculture is a very strong predictor of synchrony of species in polyculture (Fig. 3).
Our results lead us to conclude that environmental fluctuations, not species interactions, are the primary driver of community-wide species synchrony.
Likewise, our results appear to be quite general: across four arid-to-subhumid grasslands community synchrony is almost soley due to environmental fluctuations since interspecific interactions are weak.
Only in the Idaho community did removing environmental fluctuations not cause a large decrease in synchrony, but removing competition had no effect either.
Given accumulating evidence that niche differences in natural communities are large [reviewed in @Chu2015], and thus species interactions are likely to be weak, our results may be general in natural plant communities.

The insensitivity of species synchrony to model perturbations in the Idaho community challenges the consistency of our results.
Idaho's outlier status is due to its functional diversity.
In fact, when we removed the shrub (*Artemisia tripartita*) from our analyses, results from the Idaho data set conformed with results from all other sites: removing environmental stochasticity caused a significant reduction in species synchrony (Fig. SX).
Our main results for Idaho (Fig. 2), with *A. tripartita* included, demonstrate how the processes that determine species synchrony interact in complex ways.
*A. tripartita* has a facilitative effect on each grass species across all vital rates, except for a small competitive effect on *H. comata*'s survival probability (Tables SX, SX, SX).
At the same time, all the perennial grasses have negative effects on each other for each vital rate (Tables SX, SX, SX).
Thus, interspecific interactions play a relatively large role in determining synchrony in Idaho, but only when *A. tripartita* is at equilibrium abundance.
The removal of environmental variation causes a decrease in the abundance of *A. tripartita* and, in turn, a weakening of the overall effect of competition on species synchrony.
This would explain why synchrony actually increases when we remove environmental fluctuations in Idaho (Fig. 2).

A challenge to the generality of our results is that we were only able to model common, co-occuring species [see @Chu2015].
Rare species, which our analysis does not include, could be kept at low densities by competitive suppression due to strong interspecific interactions.
If we had been able to model rare species, we may have found a larger effect of competition on community synchrony.
However, rare species may occupy rare niches that do not overlap with other species, in which case synchrony would remain predominantly driven by environmental responses.
Rare species could also be limited by generalist natural enemies whose effects are density-independent but alter competitive hierarchies [@Mordecai2011].
Under such conditions, synchrony will depend on the degree of pathogen-induced fitness differences and the pathogen's response to environmental conditions.
Niether our model nor current theory explicitly considers the effects of pathogens on species synchrony, and this highlights the need for theoretical work on the interaction between mechanisms of species coexistence and mechanisms of species synchrony [@Loreau2010].

### Interspecific interactions had little impact on community synchrony
We expected community synchrony of per capita growth rates to decrease when we removed interspecific interactions [@Loreau2008a and Supplementary Information].
Contrary to expectations, community synchrony was virtually indistinguishable between simulations with and without interspecific interactions (Fig. 2).
The lack of an effect of interspecific competition on synchrony is in contrast to a large body of theoretical work that predicts a strong role for competition in creating compensatory dynamics [@Tilman1988] and a recent empirical analysis [@Gross2014].

Our results do not contradict the idea that competition can lead to compensatory dynamics, but they do highlight the fact that interspecific competition must be relatively strong to influence species synchrony.
The communities we analyzed are composed of species with very little niche overlap [@Chu2015] and weak interspecific interactions (Tables X1-X10).
Mechanistic consumer-resource models [@Lehman2000] and phenomenological Lotka-Volterra models [@Lehman2000; @Loreau2013] both confirm that the effect of competition on species synchrony diminishes as niche overlap increases.
In that sense, our results are not surprising: interspecific interactions are weak, so of course removing them does not affect synchrony.
More surprising is that our focal communities have little niche overlap. 
But, as discussed by @Chu2015, little niche overlap becomes less surprising when we consider the virtually limitless niche axes upon which species can partition themselves [@Clark2010].

Our results are in direct contrast to a recent analysis of several biodiversity-ecosystem function experiments that found competition drives species synchrony in grasslands [@Gross2014].
This is surprising given the extremely weak species interactions we estimated.
But the apparent inconsistency between our results and those of @Gross2014 disappears when we consider the differences between our studies.
Gross et al.'s results are based on experimentally-assembled communities that have coexisted for, at most, 11 years.
In contrast, the natural communities we studied consist of species that have coexisted for decades and have virtually zero niche overlap [@Chu2015].
In theory, species interactions should weaken through time as community assembly progesses [@Kokkoris1999], meaning that in biodiversity-ecosystem function experiments community assembly processes that can result in competitive exclusion may yet to have been realized.
Therefore, such communities may be highly influenced by transient, but strong, interspecific competition that can mask the synchronizing effects of the environment.
This also leads to the prediction that community synchrony is driven by competition in recently assembled communities, while synchrony is driven by environmental fluctuations in communities that have undergone extensive species sorting.
In other words, in the absence of disturbance and invasion, the dominant driver of community synchrony should shift from competition to environmental fluctuations through time.
One way to test this prediction is to continue collecting data from biodiversity-ecoystem function experiments and conduct the analysis of @Gross2014 every few years.


CONCLUSIONS
-----------
Species-specific responses to temporally fluctuating environmental conditions is an important mechanism underlying asynchronous population dynamics and, in turn, ecosystem stability [@Loreau2013].
When we removed environmental variation, we found that synchrony decreased in four out of the five grassland communities we studied (Fig. 2).
A tempting conclusion is that our study confirms that compensatory dynamics are rare in natural communities, and that ecologically-similar species will exhibit synchronous dynamics [e.g., @Houlahan2007].
Such a conclusion is only half correct.
The perennial grasses we studied do have similar responses to the environment (Table X1-X10), which will tend to synchronize dynamics.
However, if community-wide species synchrony is less than 1, some degree of compensatory dynamics must be present [@Loreau2008a].
Since observed and simulated synchrony is less than 1 in all our focal communities (Table 2 and Fig. 2), we conclude that compensatory dynamics are common in natural grasslands.
But, in agreement with other studies [@Rocha2011; @Vasseur2014], we find that environmental responses are primarily responsible for the degree of synchrony among ecologically-similar species.
Such a conclusion is in contrast to a recent analysis of several biodiversity-ecosystem function experiments showing that competition drives community synchrony [@Gross2014].
It may be that recently assembled communities, such as experimental plots, exhibit strong species interactions that will weaken over time [@Kokkoris1999].
Viewing community synchrony through the lens of community assembly processes may provide a way to reconcile inconsistent observations on the biotic and abiotic forces that jointly drive community dynamics.


ACKNOWLEDGMENTS
---------------
This work was funded by the National Science Foundation through a Postdoctoral Research Fellowship in Biology to ATT (DBI-1400370) and a CAREER award to PBA (DEB-1054040). CdM and ML were supported by the TULIP Laboratory of Excellence (ANR-10-LABX-41). We thank the original mappers of the permanent quadrats at each site and the digitizers in the Adler lab, without whom this work would not have been possible. Compute, storage and other resources from the Division of Research Computing in the Office of Research and Graduate Studies at Utah State University are gratefully acknowledged.

\setlength{\parindent}{0ex}
\newpage{}


Tables
------

\singlespacing

Table 1: Site descriptions and focal species.
\footnotesize

| Site Name | Biome | Location (Lat, Lon) | Obs. Years | Species |
| --------- | ----- | ------------------- | ---------- | ------- |
| Arizona | Sonoran Desert | 31&deg;50' N, 110&deg;53' W | 1915-1933 | *Bouteloua eriopoda* |
| | | | | *Bouteloua rothrockii* |
| Idaho | Sagebrush steppe | 44.2&deg; N, 112.1&deg; W | 1926-1957 | *Artemisia tripartita* |
| | | | | *Pseudoroegneria spicata* |
| | | | | *Hesperostipa comata* |
| | | | | *Poa secunda* |
| Kansas | Southern mixed prairie | 38.8&deg; N, 99.3&deg; W | 1932-1972 | *Bouteloua curtipendula* |
| | | | | *Bouteloua hirsuta* |
| | | | | *Schizachyrium scoparium* |
| Montana | Northern mixed prairie | 46&deg;19' N, 105&deg;48' W | 1926-1957 | *Bouteloua gracilis* |
| | | | | *Hesperostipa comata* |
| | | | | *Pascopyrum smithii* |
| | | | | *Poa secunda* |
| New Mexico | Chihuahuan Desert | 32.62&deg; N, 106.67&deg; W | 1915-1950 | *Bouteloua eriopoda* |
| | | | | *Sporobolus flexuosus* |

\normalsize

\pagebreak{}

```{r load_libs, echo=FALSE, message=FALSE, warning=FALSE}
library(communitySynchrony)
library(plyr)
library(reshape2)
library(synchrony)
library(ggplot2)
library(xtable)
library(gridExtra)
library(RColorBrewer)
```

```{r get_all_data, echo=FALSE, eval=T}
site <- "Kansas"
spp_list <- c("BOCU","BOHI","SCSC")
num_spp <- length(spp_list)
ks_data <- data.frame(quad=NA, year=NA, totCover=NA, species=NA)
for(dospp in 1:num_spp){ #loop through species to read in data
  spp_now <- spp_list[dospp]
  quad_file <- paste("../data/", site,"/",spp_now,"/quadratCover.csv",sep="")
  spp_data <- read.csv(quad_file)
  spp_data$species <- spp_now
  ks_data <- rbind(ks_data, spp_data)
} #end species looping for raw data
ks_data <- ks_data[2:nrow(ks_data),] #remove first NA row

tmp1<-which(ks_data$quad_data=="q25" & (ks_data$year<35 | ks_data$year>62))
tmp2<-which(ks_data$quad_data=="q27")
tmp3<-which(ks_data$quad=="q28")
tmp4<-which(ks_data$quad=="q30")
tmp5<-which(ks_data$quad=="q31" & (ks_data$year<35 | ks_data$year>39))
tmp6<-which(ks_data$quad=="q32" & (ks_data$year<35 | ks_data$year>41))
tmp<-c(tmp1,tmp2,tmp3,tmp4,tmp5,tmp6)
ks_data<-ks_data[-tmp,]

# exclude the records later than 1968, to keep the same random year effect...
ks_data<-subset(ks_data,year<68)


site <- "Idaho"
spp_list <- sort(c("PSSP","HECO","POSE","ARTR"))
num_spp <- length(spp_list)
id_data <- data.frame(quad=NA, year=NA, totCover=NA, species=NA)
for(dospp in 1:num_spp){ #loop through species to read in data
  spp_now <- spp_list[dospp]
  quad_file <- paste("../data/", site,"/",spp_now,"/quadratCover.csv",sep="")
  spp_data <- read.csv(quad_file)
  spp_data$species <- spp_now
  id_data <- rbind(id_data, spp_data)
} #end species looping for raw data
id_data <- id_data[2:nrow(id_data),] #remove first NA row
# id_data <- subset(id_data, species!="ARTR") #take out the shrub


site <- "Montana"
spp_list <- sort(c("BOGR","HECO","PASM","POSE"))
num_spp <- length(spp_list)
mt_data <- data.frame(quad=NA, year=NA, totCover=NA, species=NA)
for(dospp in 1:num_spp){ #loop through species to read in data
  spp_now <- spp_list[dospp]
  quad_file <- paste("../data/", site,"/",spp_now,"/quadratCover.csv",sep="")
  spp_data <- read.csv(quad_file)
  spp_data$species <- spp_now
  mt_data <- rbind(mt_data, spp_data)
} #end species looping for raw data
mt_data <- mt_data[2:nrow(mt_data),] #remove first NA row



site <- "NewMexico"
spp_list <- sort(c("BOER","SPFL"))
num_spp <- length(spp_list)
nm_data <- data.frame(quad=NA, year=NA, totCover=NA, species=NA)
for(dospp in 1:num_spp){ #loop through species to read in data
  spp_now <- spp_list[dospp]
  quad_file <- paste("../data/", site,"/",spp_now,"/quadratCover.csv",sep="")
  spp_data <- read.csv(quad_file)
  spp_data$species <- spp_now
  nm_data <- rbind(nm_data, spp_data)
} #end species looping for raw data
nm_data <- nm_data[2:nrow(nm_data),] #remove first NA row



site <- "Arizona"
spp_list <- sort(c("BOER","BORO"))
num_spp <- length(spp_list)
az_data <- data.frame(quad=NA, year=NA, totCover=NA, species=NA)
for(dospp in 1:num_spp){ #loop through species to read in data
  spp_now <- spp_list[dospp]
  quad_file <- paste("../data/", site,"/",spp_now,"/quadratCover.csv",sep="")
  spp_data <- read.csv(quad_file)
  spp_data$species <- spp_now
  az_data <- rbind(az_data, spp_data)
} #end species looping for raw data
az_data <- az_data[2:nrow(az_data),] #remove first NA row
```

```{r get_all_synch, echo=FALSE, include=TRUE, eval=T, cache=FALSE}
out_ks <- get_comm_synchrony(ts_data = ks_data)
out_id <- get_comm_synchrony(ts_data = id_data)
out_mt <- get_comm_synchrony(ts_data = mt_data)
out_nm <- get_comm_synchrony(ts_data = nm_data)
out_az <- get_comm_synchrony(ts_data = az_data)
```


```{r synchrony_table, echo=FALSE, include=TRUE, results='asis', message=FALSE, eval=T, cache=FALSE}
get_table_metrics <- function(output){
  tmp <- output
  exp_tmp <- round(tmp$pgr_expected_synch_ind_flucts, 2)
  obs_tmp <- round(as.numeric(tmp$pgr_synchrony[1]), 2)
  demo_tmp <- obs_tmp - exp_tmp
  exp_cover <- round(as.numeric(tmp$cover_expected_synch_ind_flucts), 2)
  obs_cover <- round(as.numeric(tmp$abund_synchrony[1]), 2)
  demo_cover <- obs_cover - exp_cover
  plant_size <- tmp$avg_size
  cover_var <- tmp$variability
  return(c(obs_tmp, exp_tmp, demo_tmp, obs_cover, exp_cover, 
           demo_cover, cover_var))
}

table_data <- as.data.frame(rbind(get_table_metrics(out_az),
                                  get_table_metrics(out_id),
                                  get_table_metrics(out_ks),
                                  get_table_metrics(out_mt),
                                  get_table_metrics(out_nm)))
alltable_data <- table_data
table_data$Site <- c("Arizona", "Idaho", "Kansas", "Montana", "New Mexico")
table_data <- table_data[,c("Site", "V1", "V4", "V7")]
table_data$spp <- c(length(unique(az_data$species)),
                    length(unique(id_data$species)),
                    length(unique(ks_data$species)),
                    length(unique(mt_data$species)),
                    length(unique(nm_data$species)))
colnames(table_data) <- c("Site",
                          "$\\phi_{r}$", 
                          "$\\phi_{C}$",
                          "CV of Total Cover",
                          "Species richness")
# colnames(table_data) <- c("Site",
#                           "$\\phi_{r}$", 
#                           "$\\text{E}(\\phi_{r})$", 
#                           "$\\text{E}(\\sigma_{r,c} + \\sigma_{r,e})$",
#                           "$\\phi_{C}$", 
#                           "$\\text{E}(\\phi_{C})$",
#                           "$\\text{E}(\\sigma_{C,c} + \\sigma_{C,e})$",
#                           "CV of Total Cover",
#                           "Species richness")
# table_data[,3] <- round(1/table_data[,ncol(table_data)],2) # reset expected sybchrony to 1/S
# table_data[,4] <- table_data[,2] - table_data[,3] # calculate obs - exp synchrony

synch_cap <- "Observed synchrony among species' per capita growth rates ($\\phi_{r}$), observed synchrony among species' percent cover ($\\phi_{C}$), the coefficient of variation of total community cover, and species richness for each community. Species richness values reflect the number of species analyzed from the community, not the actual richness."
print(xtable(table_data, caption = synch_cap),
      caption.placement="top",
      include.rownames = F, 
      sanitize.colnames.function = identity,
      comment=FALSE,
      size="normalsize")
```

\pagebreak{}

```{r prediction_table, echo=FALSE, include=TRUE, results='asis', message=FALSE, eval=T, cache=FALSE}
exp_synchrony_env <- readRDS("../results/envstoch_predictions.RDS")
exp_synchrony_env <- exp_synchrony_env[complete.cases(exp_synchrony_env),]
exp_synchrony_demo <- alltable_data[,c("V2","V5")]
exp_synchrony_demo$site <- table_data$Site
colnames(exp_synchrony_demo) <- c("pgr", "cover", "site")
sims_output <- readRDS("../results/allsims_plot_data.RDS")

pred_table <- data.frame(site = table_data$Site,
                         exp_demo = exp_synchrony_demo$pgr,
                         sim_demo = round(subset(sims_output, simulation=="6No Comp. + No E.S.")["synchrony"],2),
                         exp_env = round(exp_synchrony_env$growthrate_prediction,2),
                         sim_env = round(subset(sims_output, simulation=="5No Comp. + No D.S.")["synchrony"],2))

colnames(pred_table) <- c("Site", 
                          "Predicted $\\phi_{R,\\mathcal{M}_D}$",
                          "Simulated $\\phi_{R,\\mathcal{M}_D}$",
                          "Predicted $\\phi_{R,\\mathcal{M}_E}$",
                          "Simulated $\\phi_{R,\\mathcal{M}_E}$")

pred_cap <- "Predicted and simulated synchrony of per capita growth rates under the two limiting cases."
print(xtable(pred_table, caption = pred_cap),
      caption.placement="top",
      include.rownames = F, 
      sanitize.colnames.function = identity,
      comment=FALSE,
      size="normalsize")
```

\pagebreak{}

Figures
-------

```{r time_series_fig, echo=FALSE, include=TRUE, fig.width=8.5, fig.height=4, fig.cap="Observed time series of mean percent cover (averaged over quadrats for each year) and per capita growth rates for each species at each site. Panels are labeled by site codes: AZ = Arizona, ID = Idaho, KS = Kansas, MT = Montana, and NM = New Mexico.", eval=F}
out_ks$percent_cover$site <- "Kansas"
out_id$percent_cover$site <- "Idaho"
out_mt$percent_cover$site <- "Montana"
out_nm$percent_cover$site <- "New Mexico"
out_az$percent_cover$site <- "Arizona"
cover_data <- rbind(out_ks$percent_cover, out_id$percent_cover,
                    out_mt$percent_cover, out_nm$percent_cover, 
                    out_az$percent_cover)

out_ks$growth_rates$site <- "Kansas"
out_id$growth_rates$site <- "Idaho"
out_mt$growth_rates$site <- "Montana"
out_nm$growth_rates$site <- "New Mexico"
out_az$growth_rates$site <- "Arizona"
pgr_data <- rbind(out_ks$growth_rates, out_id$growth_rates,
                  out_mt$growth_rates, out_nm$growth_rates, 
                  out_az$growth_rates)
all_spp <- unique(pgr_data$species)
color_match <- data.frame(species = all_spp,
                          color = brewer.pal(12,"Paired"))
pgr_data <- merge(pgr_data, color_match, by = "species")
cover_data <- merge(cover_data, color_match, by="species")

### Create labelling dataframe
site_list <- unique(cover_data$site)
textdf <- data.frame(species=NA, year=NA, tot_cover=NA, num_obs=NA, site=NA, color=NA)
for(dosite in site_list){
  tmp <- subset(cover_data, site==dosite)
  if(dosite=="Kansas"){
    maxyr <- min(unique(tmp$year))
    textdf <- rbind(textdf,tmp[tmp$year == maxyr, ])
  }
  if(dosite!="Kansas"){
    maxyr <- max(unique(tmp$year))
    textdf <- rbind(textdf,tmp[tmp$year == maxyr, ])
    textdf$year <- textdf$year+2
  }
}
textdf <- textdf[2:nrow(textdf),]

### Change site to two-letter codes
site_list <- sort(unique(cover_data$site))
sitecode <- c("AZ", "ID", "KS", "MT", "NM")
for(i in 1:length(site_list)){
  cover_data[cover_data$site==site_list[i], "site"] <- sitecode[i]
  pgr_data[pgr_data$site==site_list[i], "site"] <- sitecode[i]
}

cover_plot <- ggplot(data=cover_data, aes(x=(year+1900), y=tot_cover, color=color))+
                geom_line(alpha=0.25)+
                geom_point(size=2)+
                facet_grid(site~., scales = "free_y")+
                guides(color=FALSE)+
                ylab("Mean Percent Cover")+
                xlab("Year")+
                scale_color_manual(values = brewer.pal(12,"Paired"))+
                theme_bw()

pgr_plot <- ggplot(data=pgr_data, aes(x=(year+1900), y=pgr, color=color))+
              geom_line(alpha=0.25)+
                geom_point(size=2)+
              facet_grid(site~.)+
              guides(color=FALSE)+
              ylab("Per Capita Growth Rate")+
              xlab("Year")+
              scale_color_manual(values = brewer.pal(12,"Paired"))+
              theme_bw()
full_plot <- grid.arrange(cover_plot, pgr_plot, ncol=2)
```


```{r concept_fig, echo=FALSE, fig.cap="Conceptual figure outlining the effects of interspecific interactions and environmental stochasticity in large populations where demographic stochasticity is effectively absent (A) and in populations of varying size where demographic stochasticity is present (B).", eval=F}
library(png)
library(grid)
img <- readPNG("./components/synchrony_conceptual_fig.png")
grid.raster(img)
```

```{r read_data, echo=FALSE, eval=T}
output_list <- readRDS("../results/ipm_comp_nocomp_sims.RDS")
mlist <- melt(output_list)
```

```{r figure_1, echo=FALSE, fig.cap="Observed (vertical dashed lines) and simulated (solid density curves) synchrony of species per capita growth rates at each site from the IPM (left panels) and the IBM (right panels). IPM density curves come from 100 random contiguous sections from 2,000 iteration IPM runs, where the length of each randomly selected section is equal to the numnber of observation years for each data set. IBM density curves come from 100 replicate simulations of 75 iterations each. Synchrony values come from simulations where environmental stochasticity and interspecific interactions are present. The IBM was run on a 5 by 5 meter landscape to reduce the effect of demographic stochasticity.", fig.width=6, fig.height=6, fig.width=6, eval=F}
nyrs <- c(max(out_az$stability$num_observations),
          max(out_id$stability$num_observations),
          max(out_ks$stability$num_observations),
          max(out_mt$stability$num_observations),
          max(out_nm$stability$num_observations))

boots <- 100
sites <- sort(table_data$Site)
sites[5] <- "NewMexico"
synch <- matrix(NA, boots, length(sites))

for(do_site in 1:length(sites)){
  full_ipm_outs <- subset(mlist, L2=="ENVINTER")
  site_ipm <- subset(full_ipm_outs, L1==sites[do_site])
  colnames(site_ipm) <- c("year", "species", "cover", "L1", "L2")
  # if(sites[do_site]=="Idaho") site_ipm <- subset(site_ipm, Var2!="ARTR")
  species_list <- unique(site_ipm$species)
  num_spp <- length(species_list)
  for(i in 1:boots){
    begin_year <- sample(x = 1:(max(site_ipm$year)-nyrs[do_site]), 1)
    end_year <- begin_year+nyrs[do_site]
    tmp <- subset(site_ipm, year %in% begin_year:end_year)
    tmp2 <- dcast(tmp, year~species, value.var = "cover")

    # caclulate observed growth rates
    # create lagged data frame to only get observed yearly transitions
    lag_df <- tmp2
    lag_df$lagyear <- lag_df$year+1
    colnames(lag_df)[2:(num_spp+1)] <- paste0(colnames(lag_df)[2:(num_spp+1)],"_t0") 
    
    # merge the lag df with observed
    rm_col <- which(colnames(lag_df)=="year")
    merged_df <- merge(tmp2, lag_df[,-rm_col], by.x = "year", by.y="lagyear")
    transitions <- nrow(merged_df)
    obs_gr <- matrix(nrow=transitions, ncol=num_spp)
    name_ids1 <- which(colnames(merged_df) %in% species_list)
    name_ids2 <- which(colnames(merged_df) %in% paste(species_list, "_t0", sep=""))
    for(ii in 1:transitions){
      obs_gr[ii,] <- as.numeric(log(merged_df[ii,name_ids1]/merged_df[ii,name_ids2]))
    }
    synch[i,do_site] <- as.numeric(community.sync(obs_gr)[1])
  }
}

colnames(synch) <- sites
synch_df <- melt(synch)

obs_pgr_df <- c(as.numeric(out_az$pgr_synchrony[1]),
                as.numeric(out_id$pgr_synchrony[1]),
                as.numeric(out_ks$pgr_synchrony[1]),
                as.numeric(out_mt$pgr_synchrony[1]),
                as.numeric(out_nm$pgr_synchrony[1]))
obs_pgr_df <- data.frame(pgr_synch=obs_pgr_df,
                         Var2=sites)

### Get IBM synchs
synch_df$type <- "IPM"
synch_df <- synch_df[,2:ncol(synch_df)]
ibm_poly <- readRDS("../devel/mono_poly_ibm.RDS")
ibm_poly <- subset(ibm_poly, typesynch=="Per capita growth rate")
ibm_poly$type <- "IBM"
ibm_df <- ibm_poly[,c("site","synch","type")]
names(ibm_df) <- names(synch_df)
synch_df <- rbind(synch_df, ibm_df)




g1 <- ggplot()+
  geom_line(data=subset(synch_df, type=="IPM"), aes(x=value, color=Var2), 
            stat="density", adjust=2)+
  geom_vline(data=obs_pgr_df, aes(xintercept=pgr_synch, color=Var2), linetype=2)+
  facet_wrap("Var2", ncol=1, scales="free_y")+
  scale_color_manual(values = c("grey45", "steelblue", "slateblue4", "darkorange", "purple"))+
  guides(color=FALSE)+
  xlab("Community Synchrony")+
  ylab("Estimated Probability Density")+
  ggtitle("IPM")+
  scale_x_continuous(limits=c(0,1))+
  theme_bw()

g2 <- ggplot()+
  geom_line(data=subset(synch_df, type=="IBM"), aes(x=value, color=Var2), 
            stat="density", adjust=2)+
  geom_vline(data=obs_pgr_df, aes(xintercept=pgr_synch, color=Var2), linetype=2)+
  facet_wrap("Var2", ncol=1, scales="free_y")+
  scale_color_manual(values = c("grey45", "steelblue", "slateblue4", "darkorange", "purple"))+
  guides(color=FALSE)+
  xlab("Community Synchrony")+
  ylab("Estimated Probability Density")+
  ggtitle("IBM")+
  scale_x_continuous(limits=c(0,1))+
  theme_bw()

grid.arrange(g1,g2,ncol=2)
```


<!--
\begin{figure}[!ht]
  \centering
      \includegraphics[width=3in]{./components/formatted_fig1.png}
  \caption{Observed versus predicted synchrony of growth rates under our two limiting case predictions. The observed synchrony of per capita growth rates was best predicted by our theoretical prediction in the limiting case of only environmental stochasticity operating ($\phi_R$; green line and points in left panel): it was the only regression line whose slope and intercept did not significantly differ from zero or one, respectively.}
\end{figure}


\pagebreak{}
-->

\begin{figure}[!ht]
  \centering
      \includegraphics[width=6in]{./components/formatted_fig2.png}
  \caption{Community-wide species synchrony of per capita growth rates from model simulation experiments. Synchrony of species' growth rates for each study area are from simulation experiments with demographic stochasticity, environmental stochasticity, and interspecific competition present (``All Drivers''), demographic stochasticity removed (``No D.S.''), environmental stochasticity removed (``No E.S.''), interspecific competition removed (``No Comp.''), interspecific competition and demographic stochasticity removed (``No Comp. + No D.S.''), and interspecific competition and environmental stochasticity removed (``No Comp. + No E.S.''). Abbreviations within the bars for the Arizona site indicate whether the IBM or IPM was used for a particular simulation. Error bars represent the upper and lower 95\% quantiles from model simulations.}
\end{figure}

\pagebreak{}

\begin{figure}[!ht]
  \centering
      \includegraphics[width=6in]{./components/ibm_sims_across_landscape.png}
  \caption{Synchrony of species' growth rates for each study area from IBM simulations across different landscape sizes when all drivers are present (``All Drivers'') and where only demographic stochasticity is present (``No E.S. + No Comp.''). The strength of demographic stochasticity decreases as landscape size increases. Error bars represent the upper and lower 95\% quantiles from model simulations.}
\end{figure}

\pagebreak{}

\begin{figure}[!ht]
  \centering
      \includegraphics[width=4in]{./components/poly_vs_mono_synch.png}
  \caption{Synchrony of species per capita growth rates (filled circles) and percent cover (filled triangles) simulated in monoculture (without species interactions) versus synchrony in polyculture (with species interactions). We used the same sequence of random year effects for both simulations (monoculture and polyculture) to mimic biodiversity-ecosystem function experiments. The dashed line is the line of equality.}
\end{figure}

\pagebreak{}

```{r time_series, eval=FALSE, echo=FALSE, fig.cap="Example time series from the simulations.", eval=F}
ggplot(mlist, aes(x=year, y=(cover*100), color=species))+
  geom_line()+
  facet_grid(L1~L2, scale="free")
```


References
----------